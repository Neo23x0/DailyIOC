rule RAN_ALPHV_Dec_2021_1
{
    meta:
        description = "Detect AlphV ransomware (November 2021)"
        author = "Arkbird_SOLG"
        date = "2021-12-09"
        reference = "Internal Research"
        hash1 = "3d7cf20ca6476e14e0a026f9bdd8ff1f26995cdc5854c3adb41a6135ef11ba83"
        hash2 = "7e363b5f1ba373782261713fa99e8bbc35ddda97e48799c4eb28f17989da8d8e"
        hash3 = "cefea76dfdbb48cfe1a3db2c8df34e898e29bec9b2c13e79ef40655c637833ae"
        tlp = "white"
        adversary = "BlackCat"
    strings:
        $s1 = { ff b4 24 [2] 00 00 6a 00 ff 35 ?? e1 ?? 00 e8 [3] 00 8d 8c 24 [2] 00 00 ba [3] 00 68 c0 1f 00 00 e8 [3] ff 83 c4 04 ?? bc 24 [2] 00 00 }
        $s2 = { 85 f6 74 47 8b 3d ?? e1 ?? 00 85 ff 0f 85 81 00 00 00 eb 60 68 [3] 00 6a 00 6a 00 e8 [2] 04 00 85 c0 0f 84 99 01 00 00 89 c1 31 c0 f0 0f b1 0d ?? e1 ?? 00 0f 84 f0 fe ff ff 89 c6 51 e8 [2] 04 00 89 f1 e9 e1 fe ff ff 68 [3] 00 ff 35 ?? e1 ?? 00 e8 [2] 04 00 85 c0 0f 84 32 03 00 00 89 c6 a3 ?? e1 ?? 00 8b 3d ?? e1 ?? 00 85 ff 75 1f 68 [3] 00 ff 35 ?? e1 ?? 00 e8 [2] 04 00 85 c0 0f 84 09 03 00 00 89 c7 a3 ?? e1 ?? 00 89 74 24 18 e8 [2] 04 00 8b 35 ?? e1 ?? 00 89 44 24 14 85 f6 75 1f 68 [3] 00 ff 35 ?? e1 ?? 00 e8 [2] 04 00 85 c0 0f 84 b8 01 00 00 89 c6 a3 ?? e1 ?? 00 8d 44 24 70 c7 44 24 64 00 00 00 00 c7 44 24 60 00 00 00 00 68 0c 01 00 00 6a 00 50 e8 [2] 04 00 83 }
        $s3 = { 8d 85 6c ff ff ff b9 [3] 00 8d 55 90 89 45 90 c7 45 94 [3] 00 a1 ?? e0 ?? 00 c7 45 ac 03 00 00 00 c7 45 b0 [3] 00 c7 45 b4 ?? 00 00 00 c7 45 b8 [3] 00 c7 45 bc 01 00 00 00 c7 45 c0 00 00 00 00 89 55 c8 8d 55 ac c7 45 cc 01 00 00 00 c7 45 d0 00 00 00 00 c7 45 d8 ?? 00 00 00 c7 45 d4 [3] 00 c7 45 dc 00 00 00 00 c7 45 e4 ?? 00 00 00 c7 45 e0 [3] 00 c7 45 e8 01 00 00 00 c7 45 ec 83 00 00 00 83 f8 02 b8 [3] 00 0f 44 05 [3] 00 0f 44 0d [3] 00 52 51 ff 50 14 83 c4 08 a1 [3] 00 c7 85 64 ff ff ff 00 00 00 00 c7 85 50 ff ff ff 00 00 00 00 c7 85 4c ff ff ff 00 00 00 00 89 45 a0 c7 45 a4 00 00 00 00 c7 45 a8 00 00 00 00 0f 1f 00 8b ?? 6c ff ff ff 8b ?? 70 ff ff ff 8d }
        $s4 = { a1 ?? e0 ?? 00 b9 [3] 00 8d 94 24 ?? 01 00 00 c7 84 24 ?? 01 00 00 03 00 00 00 c7 84 24 ?? 01 00 00 [3] 00 c7 84 24 ?? 01 00 00 14 00 00 00 c7 84 24 ?? 01 00 00 [3] 00 c7 84 24 ?? 01 00 00 01 00 00 00 c7 84 24 ?? 01 00 00 00 00 00 00 c7 84 24 ?? 01 00 00 [3] 00 c7 84 24 ?? 01 00 00 00 00 00 00 c7 84 24 ?? 01 00 00 00 00 00 00 c7 84 24 ?? 01 00 00 14 00 00 00 c7 84 24 ?? 01 00 00 [3] 00 c7 84 24 ?? 01 00 00 00 00 00 00 c7 84 24 ?? 01 00 00 1e 00 00 00 c7 84 24 ?? 01 00 00 [3] 00 c7 84 24 ?? 01 00 00 01 00 00 00 c7 84 24 ?? 01 00 00 ?? 00 00 00 83 f8 02 b8 [3] 00 0f 44 05 [3] 00 0f 44 0d [3] 00 52 51 ff 50 14 83 c4 08 8b 3d [3] 00 89 7c 24 ?? c7 44 24 ?? 00 00 00 00 c7 44 24 ?? 00 00 00 00 e8 [3] 00 89 44 24 0c b0 41 31 d2 31 f6 b4 41 eb 49 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 40 00 8b 7c 24 ?? 8d 04 52 42 89 1c 87 c7 44 87 04 01 00 00 00 c7 44 87 08 01 00 00 00 8a 24 24 0f b6 5c 24 04 89 54 24 ?? 80 fc 5b 0f 93 c0 46 08 c3 88 e0 80 fb 01 0f 84 88 00 00 00 8b 4c 24 0c 3c 5a 0f 93 c3 80 d4 00 0f a3 f1 73 db c7 84 24 ?? 01 00 00 00 00 00 00 88 5c 24 04 88 24 24 88 84 24 ?? 01 00 00 a1 ?? e1 ?? 00 85 }
    condition:
       uint16(0) == 0x5A4D and filesize > 300KB and all of ($s*) 
}
